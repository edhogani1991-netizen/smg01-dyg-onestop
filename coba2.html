<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>cloudkitchen.dyg++ | Pemesanan Online</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        /* CSS ASLI ANDA - JANGAN UBAH */
        :root { 
            --primary: #1B4332; --accent: #F39C12; --bg: #F8FBF8; 
            --surface: #FFFFFF; --text: #2D3436; --muted: #636E72;
            --soft: #F0F0F0; --danger: #D63031; --success: #00B894;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; padding: 0; background: var(--bg); font-family: 'Inter', sans-serif; color: var(--text); overflow-x: hidden; }

        /* HEADER & BANNER ASLI */
        .header-top { background: var(--primary); padding: 5px 15px 18px; color: white; border-radius: 0 0 20px 20px; }
        .nav-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .brand-logo { font-weight: 700; font-size: 15px; display: flex; align-items: center; gap: 6px; }
        .brand-icon { width: 26px; height: 26px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 10px; font-weight: 800; }
        .queue-badge { background: var(--danger); color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; }
        .banner-container { margin: -10px 15px 15px; position: relative; overflow: hidden; border-radius: 15px; height: 180px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); background: #eee; }
        #banner-track { display: flex; transition: transform 0.4s ease; height: 100%; }
        #banner-track img { min-width: 100%; object-fit: cover; }

        /* MENU & VARIAN ASLI */
        .service-mode { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; padding: 15px 12px; }
        .service-btn { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .service-btn .icon { width: 65px; height: 65px; background: white; border-radius: 20px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; box-shadow: 0 10px 20px rgba(0,0,0,0.06); }
        .service-icon-img { width: 75%; height: 75%; object-fit: contain; }
        .service-btn.active .icon { background: var(--primary); }
        .service-btn.active .service-icon-img { filter: brightness(0) invert(1); }
        
        #map { height: 130px; border-radius: 18px; margin: 0 18px 20px; border: 1px solid #EFEFEF; }
        .main-content { padding: 0 18px 180px; }
        .input-card { background: white; border-radius: 14px; padding: 10px 14px; margin-bottom: 10px; border: 1.2px solid #F0F0F0; }
        .input-card label { display: block; font-size: 9px; font-weight: 700; color: var(--muted); text-transform: uppercase; margin-bottom: 3px; }
        .input-card input, .input-card textarea { width: 100%; border: none; font-size: 13px; font-weight: 600; outline: none; background: transparent; }

        /* --- PENYESUAIAN BOTTOM BAR SESUAI GAMBAR --- */
        .bottom-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: white; padding: 12px 16px 24px; 
            border-radius: 24px 24px 0 0; box-shadow: 0 -10px 30px rgba(0,0,0,0.1); 
            z-index: 1000; 
        }
        .bottom-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .total-price { font-size: 22px; font-weight: 900; color: var(--primary); }
        .btn-detail { background: #E8F5E9; color: var(--primary); border: none; padding: 6px 12px; border-radius: 12px; font-size: 10px; font-weight: 800; }

        .bottom-actions { display: flex; gap: 10px; align-items: stretch; height: 54px; }
        
        /* Tombol Voucher & Poin Baru */
        .btn-extra { 
            background: white; border: 1.5px solid #F0F0F0; border-radius: 16px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            min-width: 65px; font-size: 9px; font-weight: 800; color: #777;
        }
        .btn-extra img { width: 20px; height: 20px; margin-bottom: 4px; }

        .btn-order { 
            flex: 1; background: #BDC3C7; color: white; border: none; 
            border-radius: 16px; font-weight: 800; font-size: 16px; 
        }
        .btn-order.active { background: var(--primary); }

        /* MODAL */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 10001; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-card { background: white; width: 100%; max-width: 360px; padding: 25px; border-radius: 20px; text-align: center; }
    </style>
</head>
<body>

<div id="welcome-overlay" style="position:fixed; inset:0; background:white; z-index:10002; display:flex; align-items:center; justify-content:center; padding:30px;">
    <div style="text-align:center;">
        <img src="welcome4.png" style="width:250px; height:250px; border-radius:50%; margin-bottom:20px; object-fit:cover;">
        <h2 style="font-weight:900;">Siap Kasih yang Terbaik</h2>
        <button onclick="startApp()" class="btn-order active" style="width:100%; padding:15px; margin-top:20px;">MULAI</button>
    </div>
</div>

<div class="header-top">
    <div class="nav-row">
        <div class="brand-logo"><div class="brand-icon">D+</div> cloudkitchen.dyg++</div>
        <div class="queue-badge" id="noAntrean">#0</div>
    </div>
</div>

<div class="banner-container"><div id="banner-track"></div></div>

<div class="service-mode">
    <div class="service-btn active" onclick="changeMode('DINE IN', this)"><div class="icon"><img src="dine-in3.png" class="service-icon-img"></div><span>Dine In</span></div>
    <div class="service-btn" onclick="changeMode('TAKE AWAY', this)"><div class="icon"><img src="take-away3.png" class="service-icon-img"></div><span>Take Away</span></div>
    <div class="service-btn" onclick="changeMode('DELIVERY', this)"><div class="icon"><img src="delivery3.png" class="service-icon-img"></div><span>Delivery</span></div>
    <div class="service-btn" onclick="changeMode('KATERING', this)"><div class="icon"><img src="katering3.png" class="service-icon-img"></div><span>Katering</span></div>
</div>

<div id="map"></div>

<div class="main-content">
    <div class="input-card"><label>Nama Anda</label><input type="text" id="custName" placeholder="Nama lengkap..."></div>
    <div class="input-card"><label>Email (Untuk Struk Online)</label><input type="email" id="custEmail" placeholder="contoh@gmail.com"></div>
    <div id="boxMeja" class="input-card"><label>Nomor Meja</label><input type="number" id="tableNo" placeholder="00"></div>
    
    <div class="menu-grid" id="menu-container">Memuat menu...</div>
</div>

<div class="bottom-bar">
    <div class="bottom-info">
        <div class="total-price">Rp <span id="miniPrice">0</span></div>
        <button class="btn-detail">RINCIAN â†‘</button>
    </div>
    <div class="bottom-actions">
        <div class="btn-extra" onclick="showVoucher()">
            <img src="https://cdn-icons-png.flaticon.com/512/872/872243.png">
            <span>VOUCHER</span>
        </div>
        <div class="btn-extra" onclick="alert('Poin Anda akan bertambah setelah pesanan selesai!')">
            <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png">
            <span>POIN</span>
        </div>
        <button id="btnOrder" class="btn-order" onclick="openModal()" disabled>PILIH MENU</button>
    </div>
</div>

<div id="modalConfirm" class="modal-overlay">
    <div class="modal-card">
        <h3>Kirim Pesanan?</h3>
        <p>Struk akan dikirim ke Email & WhatsApp.</p>
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button onclick="closeModal()" style="flex:1; padding:12px; border:none; border-radius:12px;">Batal</button>
            <button onclick="submitOrder()" style="flex:1; padding:12px; border:none; border-radius:12px; background:var(--primary); color:white;">Ya, Kirim</button>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // MASUKKAN URL GAS ANDA DI SINI
    const CONFIG = {
        WEB_APP_URL: 'URL_GAS_ANDA', 
        MENU_CSV_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZGCGtu4xfKCj0zCGB2BldzF2fLjFCIOfVSXBAMeTM-3KGHfC9mZ_bhfaTnikwxd5427w4ULtotTJH/pub?gid=2132421401&single=true&output=csv',
        TOKEN: 'dyg-access-v2'
    };

    let menuData = [], cart = [], currentMode = 'DINE IN', myVoucher = "";

    function generateVoucher() {
        const code = "DYG-" + Math.random().toString(36).substring(2, 7).toUpperCase();
        return code;
    }

    function startApp() {
        myVoucher = generateVoucher();
        document.getElementById('welcome-overlay').style.display = 'none';
        loadMenu();
    }

    function showVoucher() {
        alert("Kode Voucher Anda: " + myVoucher + "\nSalin kode ini untuk diskon berikutnya!");
    }

    async function loadMenu() {
        const resp = await fetch(CONFIG.MENU_CSV_URL);
        const csv = await resp.text();
        menuData = csv.split('\n').slice(1).map((row, i) => {
            const cols = row.split(',');
            return { id: i, kat: cols[0], nama: cols[1], harga: parseInt(cols[2]) || 0 };
        });
        renderMenu();
    }

    function renderMenu() {
        const container = document.getElementById('menu-container');
        container.innerHTML = menuData.map(m => `
            <div class="input-card" style="display:flex; justify-content:space-between; align-items:center;">
                <div><b>${m.nama}</b><br>Rp ${m.harga.toLocaleString()}</div>
                <button onclick="addToCart(${m.id})" style="background:var(--primary); color:white; border:none; padding:8px 15px; border-radius:8px;">Tambah</button>
            </div>
        `).join('');
    }

    function addToCart(id) {
        cart.push(menuData[id]);
        updateUI();
    }

    function updateUI() {
        let total = cart.reduce((sum, item) => sum + item.harga, 0);
        document.getElementById('miniPrice').innerText = total.toLocaleString('id-ID');
        const btn = document.getElementById('btnOrder');
        if (total > 0) {
            btn.disabled = false;
            btn.classList.add('active');
            btn.innerText = "PESAN SEKARANG";
        }
    }

    function openModal() { document.getElementById('modalConfirm').style.display = 'flex'; }
    function closeModal() { document.getElementById('modalConfirm').style.display = 'none'; }

    async function submitOrder() {
        const nama = document.getElementById('custName').value;
        const email = document.getElementById('custEmail').value;
        const total = document.getElementById('miniPrice').innerText.replace(/\./g, '');
        const pesanan = cart.map(c => c.nama).join(', ');

        if(!nama || !email) return alert("Isi Nama & Email!");

        const url = `${CONFIG.WEB_APP_URL}?token=${CONFIG.TOKEN}&nama=${encodeURIComponent(nama)}&email=${encodeURIComponent(email)}&pesanan=${encodeURIComponent(pesanan)}&mode=${currentMode}&total=${total}&voucher=${myVoucher}`;
        
        // Kirim ke GAS (Database + Email)
        fetch(url, { mode: 'no-cors' });

        // Kirim ke WA
        const msg = `Halo! Pesanan Baru:\nNama: ${nama}\nTotal: Rp ${total}\nVoucher: ${myVoucher}\nStruk dikirim ke: ${email}`;
        window.location.href = `https://wa.me/6281393048132?text=${encodeURIComponent(msg)}`;
    }
</script>
</body>
</html>