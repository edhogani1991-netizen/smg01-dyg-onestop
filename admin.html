<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DYG++ ADMIN POS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; height: 100vh; overflow: hidden; }
        .dyg-green { background: #1B4332; }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
        .scroll-y { overflow-y: auto; height: calc(100vh - 120px); }
        .category-header { background: #e2e8f0; padding: 6px 12px; font-weight: 900; font-size: 11px; border-left: 4px solid #1B4332; margin-top: 15px; border-radius: 4px; }
    </style>
</head>
<body class="flex flex-col">

    <div class="dyg-green text-white p-4 flex justify-between items-center shadow-lg">
        <div>
            <p class="text-[10px] uppercase font-bold opacity-70">Saldo Laci (Cash)</p>
            <h1 id="v-cash" class="text-2xl font-black text-emerald-400">Rp 0</h1>
        </div>
        <div class="text-right">
            <p class="text-[10px] uppercase font-bold opacity-70">Profit Net (All)</p>
            <h1 id="v-net" class="text-xl font-black">Rp 0</h1>
        </div>
    </div>

    <div class="flex flex-1 overflow-hidden">
        <div class="w-3/5 p-4 scroll-y bg-white border-r">
            <h2 class="font-black text-gray-400 text-xs mb-4 uppercase tracking-tighter">Menu Utama</h2>
            <div id="menu-container"></div>
        </div>

        <div class="w-2/5 p-4 scroll-y flex flex-col gap-4">
            
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-200">
                <h3 class="font-black text-[10px] mb-2 uppercase text-gray-400">üõí Keranjang Belanja</h3>
                <div id="cart-items" class="min-h-[100px] bg-gray-50 rounded-xl p-3 text-[11px] font-bold text-gray-600 mb-3 border border-dashed">
                    Belum ada menu...
                </div>
                
                <div class="space-y-2 mb-3">
                    <input id="i-cust" placeholder="Nama Pelanggan" class="w-full p-3 bg-gray-100 rounded-xl text-xs font-bold outline-none border focus:border-emerald-500">
                    <input id="i-noHP" placeholder="No WA Member (Untuk Poin)" class="w-full p-3 bg-gray-100 rounded-xl text-xs font-bold outline-none border focus:border-emerald-500">
                    <div class="flex gap-2">
                        <input id="i-disc" type="number" oninput="recalc()" placeholder="Diskon Rp" class="flex-1 p-3 bg-red-50 text-red-600 rounded-xl text-xs font-black outline-none border">
                        <select id="i-mode" class="flex-1 p-3 bg-emerald-50 rounded-xl text-xs font-black outline-none border">
                            <option value="CASH">üíµ CASH</option>
                            <option value="QRIS">üì± QRIS</option>
                        </select>
                    </div>
                </div>

                <div class="flex justify-between items-center px-2 mb-4">
                    <span class="font-black text-sm">TOTAL</span>
                    <span id="v-total" class="text-2xl font-black text-emerald-800">Rp 0</span>
                </div>

                <button onclick="submitOrder()" id="btn-order" class="w-full dyg-green text-white py-4 rounded-xl font-black shadow-lg active:scale-95 transition-all uppercase text-sm">Proses Order</button>
                <button onclick="resetCart()" class="w-full mt-2 text-gray-400 text-[10px] font-bold uppercase">Reset Keranjang</button>
            </div>

            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-200">
                <div class="flex justify-between mb-3">
                    <button onclick="setFinTab('pengeluaran')" id="f-exp" class="text-[10px] font-black p-2 rounded bg-emerald-100 text-emerald-800">BELANJA</button>
                    <button onclick="setFinTab('online_food')" id="f-onl" class="text-[10px] font-black p-2 rounded text-gray-400">ONLINE</button>
                    <button onclick="setFinTab('modal')" id="f-mod" class="text-[10px] font-black p-2 rounded text-gray-400">MODAL</button>
                </div>
                <input id="f-desc" placeholder="Ket/Platform" class="w-full p-2 bg-gray-100 rounded mb-2 text-xs font-bold">
                <input id="f-amt" type="number" placeholder="Nominal Rp" class="w-full p-2 bg-gray-100 rounded mb-3 text-xs font-black">
                <button onclick="saveFinance()" class="w-full bg-gray-800 text-white py-2 rounded font-black text-[10px]">SIMPAN TRANSAKSI</button>
            </div>

            <div class="bg-red-50 rounded-2xl p-4 border-2 border-red-200">
                <h3 class="font-black text-[10px] mb-2 text-red-700 uppercase italic">üèÅ Tutup Buku (Closing)</h3>
                <input id="i-fisik" type="number" oninput="checkSettle()" placeholder="Uang Tunai di Laci..." class="w-full p-3 bg-white rounded-xl text-xl font-black text-red-700 outline-none border-2 border-red-100 mb-2">
                <div id="v-diff" class="text-center font-black text-[10px] text-red-400 py-1 uppercase">Selisih: Rp 0</div>
                <button id="btn-settle" disabled onclick="doSettle()" class="w-full bg-gray-300 text-white py-3 rounded-xl font-black mt-1 uppercase text-xs">Kas Belum Cocok</button>
            </div>

        </div>
    </div>

    <script>
        const API = "https://script.google.com/macros/s/AKfycby2MVd6lvkh-UCtG8SnnsDVHD3c_Z-9_3U42j1EEd4gmw_QIEj3vcMwTAxg01xrP2Fl0Q/exec"; // Ganti dengan URL GAS setelah Deploy
        const TOKEN = "dyg-access-v2";
        let cart = [], totalRaw = 0, currentTab = 'pengeluaran', sysCash = 0;

        const MENU_DATA = [
            {cat: "PAKET HEMAT+TEH", items: [["[PH] Nasi Ayam Saus Padang+ Teh", 15000],["[PH] Nasi Rica Ayam+ Teh", 15000],["[PH] Nasi Ayam bakar madu+ Teh", 15000],["[PH] Nasi Orak Arik Ayam Bali+ Teh", 15000],["[PH] Nasi Telor Balado+ Teh", 12000],["[PH] Mie Lik Goreng Nyemek+ Teh", 13000]]},
            {cat: "WARDOY", items: [["Nasi Ayam Saus Padang", 15000],["Nasi Ayam Saus Margarin", 15000],["Nasi Rica Ayam", 15000],["Nasi Ayam Bakar Madu", 15000],["Nasi Orak Arik Ayam Bali", 15000],["Nasi Telor Balado", 12000]]},
            {cat: "NASGOR", items: [["Nasgor Biasa", 12000],["Nasgor Ayam", 18000],["Nasgor Bakso", 14000],["Nasgor Gila", 20000]]},
            {cat: "PENYET", items: [["Telor Penyet", 7000],["Ayam Penyet", 14000],["Pangsit goreng Penyet", 7000]]},
            {cat: "DRINK", items: [["Es Jeruk", 5000],["Es Teh", 3000],["Susu Jahe", 10000]]}
        ];

        function init() {
            const container = document.getElementById('menu-container');
            MENU_DATA.forEach(c => {
                container.innerHTML += `<div class="category-header">${c.cat}</div><div class="menu-grid mt-2">`;
                c.items.forEach(i => {
                    container.innerHTML += `<button onclick="add('${i[0]}',${i[1]})" class="bg-white border-2 border-gray-100 p-3 rounded-xl text-left active:scale-95 transition-all">
                        <div class="text-[10px] font-black leading-tight h-8 overflow-hidden">${i[0]}</div>
                        <div class="text-[10px] font-black text-emerald-600 mt-2">Rp ${i[1].toLocaleString()}</div>
                    </button>`;
                });
                container.innerHTML += `</div>`;
            });
            refreshStats();
        }

        function add(n, p) { cart.push(n); totalRaw += p; recalc(); }
        function resetCart() { cart = []; totalRaw = 0; recalc(); }
        
        function recalc() {
            const disc = Number(document.getElementById('i-disc').value) || 0;
            document.getElementById('cart-items').innerText = cart.length ? cart.join(", ") : "Belum ada menu...";
            document.getElementById('v-total').innerText = "Rp " + (totalRaw - disc).toLocaleString();
        }

        async function submitOrder() {
            const cust = document.getElementById('i-cust').value || "Customer";
            const noWA = document.getElementById('i-noHP').value;
            const disc = Number(document.getElementById('i-disc').value) || 0;
            const mode = document.getElementById('i-mode').value;
            if(!cart.length) return alert("Pilih menu dulu!");

            const btn = document.getElementById('btn-order');
            btn.innerText = "PROSES..."; btn.disabled = true;

            const q = new URLSearchParams({
                token: TOKEN, action: "processOrder", nama: cust, noHP: noWA,
                pesanan: cart.join(", "), total: totalRaw, 
                jumlahBayar: totalRaw - disc, potongan: disc, modeBayar: mode
            });

            await fetch(`${API}?${q.toString()}`);
            alert("Order Berhasil!"); location.reload();
        }

        function setFinTab(t) {
            currentTab = t;
            ['f-exp','f-onl','f-mod'].forEach(id => document.getElementById(id).className = id.includes(t.slice(0,3)) ? 'text-[10px] font-black p-2 rounded bg-emerald-100 text-emerald-800' : 'text-[10px] font-black p-2 rounded text-gray-400');
        }

        async function saveFinance() {
            const d = document.getElementById('f-desc').value, a = document.getElementById('f-amt').value;
            if(!d || !a) return alert("Isi data!");
            const data = JSON.stringify(["", d, "ADMIN", Number(a)]);
            await fetch(`${API}?token=${TOKEN}&action=saveFinance&type=${currentTab}&data=${encodeURIComponent(data)}`);
            alert("Tersimpan!"); location.reload();
        }

        async function refreshStats() {
            const r = await fetch(`${API}?token=${TOKEN}&action=getFinance`);
            const d = await r.json();
            sysCash = d.cash;
            document.getElementById('v-cash').innerText = "Rp " + Math.round(d.cash).toLocaleString();
            document.getElementById('v-net').innerText = "Rp " + Math.round(d.net).toLocaleString();
        }

        function checkSettle() {
            const fis = Number(document.getElementById('i-fisik').value) || 0;
            const sel = fis - sysCash;
            const vDiff = document.getElementById('v-diff');
            const btn = document.getElementById('btn-settle');
            
            vDiff.innerText = "Selisih: Rp " + sel.toLocaleString();
            if(sel === 0 && fis > 0) {
                vDiff.className = "text-center font-black text-[10px] text-emerald-600 py-1 uppercase";
                btn.disabled = false; btn.className = "w-full bg-emerald-600 text-white py-3 rounded-xl font-black mt-1 uppercase text-xs"; btn.innerText = "TUTUP BUKU";
            } else {
                vDiff.className = "text-center font-black text-[10px] text-red-500 py-1 uppercase";
                btn.disabled = true; btn.className = "w-full bg-gray-300 text-white py-3 rounded-xl font-black mt-1 uppercase text-xs"; btn.innerText = "Kas Belum Cocok";
            }
        }

        async function doSettle() {
            const fis = Number(document.getElementById('i-fisik').value);
            const data = { sys: sysCash, fisik: fis, selisih: 0 };
            await fetch(`${API}?token=${TOKEN}&action=settle&data=${encodeURIComponent(JSON.stringify(data))}`);
            alert("Closing Sukses!"); location.reload();
        }

        window.onload = init;
    </script>
</body>
</html>